<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>衣類サイズ比較ツール (ビジュアル版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
        }
        /* スピナー（数値入力欄の矢印）を非表示に */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        .result-card, #visualizer-container svg {
            transition: all 0.3s ease-in-out;
        }
        /* SVGのパーツのトランジション */
        #comparison-shirt-body, #comparison-shirt-sleeve-left, #comparison-shirt-sleeve-right {
            transition: all 0.2s ease-out;
        }
        /* 服の重ね方を乗算（Multiply）に設定 */
        g#comparison-shirt {
            mix-blend-mode: multiply;
        }
        /* 増減ボタンのスタイル */
        .step-button {
            line-height: 1; /* 文字の縦位置を中央に */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Sidebar Component -->
    <nav id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-gray-900 text-white transform -translate-x-full transition-transform duration-300 ease-in-out z-50">
        <div class="flex items-center justify-between p-4 border-b border-gray-700">
            <h2 class="text-lg font-semibold">メニュー</h2>
            <button id="sidebar-close" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="p-4">
            <ul class="space-y-2">
                <li><a href="../index.html" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-700 transition-colors"><i class="fas fa-home mr-3"></i>トップページ</a></li>
                <li><a href="../Interactive_worldmap/worldmap.html" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-700 transition-colors"><i class="fas fa-globe mr-3"></i>世界地図</a></li>
                <li><a href="../bear/index.html" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-700 transition-colors"><i class="fas fa-chart-line mr-3"></i>熊被害状況</a></li>
                <li><a href="../numberplate/numberplate.html" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-700 transition-colors"><i class="fas fa-car-side mr-3"></i>ナンバープレート</a></li>
                <li><a href="./size.html" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-700 transition-colors"><i class="fas fa-ruler-combined mr-3"></i>サイズ検討</a></li>
            </ul>
        </div>
        <div class="absolute bottom-4 left-4 right-4"><div class="text-xs text-gray-400 text-center"><p>&copy; 2024 プロダクトサイト</p></div></div>
    </nav>
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
    <button id="sidebar-toggle" class="fixed top-4 left-4 z-30 bg-gray-900 text-white p-3 rounded-lg shadow-lg hover:bg-gray-800 transition-colors"><i class="fas fa-bars"></i></button>

    <div class="main-content p-4 md:p-8">
        <div class="container mx-auto max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">衣類サイズ比較ツール (ビジュアル版)</h1>
            <p class="mt-2 text-gray-600">サイズを入力して、見た目でフィット感を確認しましょう。</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- 1. お手持ちの服 -->
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                <h2 class="text-2xl font-bold mb-4 text-center text-blue-600">1. お手持ちの服</h2>
                <div class="space-y-4">
                    <div>
                        <label for="my-kitake" class="block text-sm font-medium text-gray-700">着丈</label>
                        <div class="relative mt-1">
                            <input type="number" id="my-kitake" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-blue-50 focus:ring-blue-500 focus:border-blue-500" value="70">
                            <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="my-kitake" data-step="1">▲</button>
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="my-kitake" data-step="-1">▼</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="my-yukitake" class="block text-sm font-medium text-gray-700">裄丈</label>
                         <div class="relative mt-1">
                            <input type="number" id="my-yukitake" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-blue-50 focus:ring-blue-500 focus:border-blue-500" value="83">
                            <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="my-yukitake" data-step="1">▲</button>
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="my-yukitake" data-step="-1">▼</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="my-katahaba" class="block text-sm font-medium text-gray-700">肩幅</label>
                        <div class="relative mt-1">
                            <input type="number" id="my-katahaba" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-blue-50 focus:ring-blue-500 focus:border-blue-500" value="44">
                            <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="my-katahaba" data-step="1">▲</button>
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="my-katahaba" data-step="-1">▼</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="my-mihaba" class="block text-sm font-medium text-gray-700">身幅</label>
                        <div class="relative mt-1">
                            <input type="number" id="my-mihaba" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-blue-50 focus:ring-blue-500 focus:border-blue-500" value="52">
                            <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="my-mihaba" data-step="1">▲</button>
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="my-mihaba" data-step="-1">▼</button>
                            </div>
                        </div>
                    </div>
                    <div class="pt-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">この服のフィット感は？</label>
                        <div class="flex justify-around bg-gray-100 p-1 rounded-lg">
                            <label class="w-full text-center cursor-pointer"><input type="radio" name="fit-preference" value="small" class="sr-only peer"><span class="block py-2 px-3 rounded-md peer-checked:bg-blue-500 peer-checked:text-white">小さい</span></label>
                            <label class="w-full text-center cursor-pointer"><input type="radio" name="fit-preference" value="just" class="sr-only peer" checked><span class="block py-2 px-3 rounded-md peer-checked:bg-blue-500 peer-checked:text-white">ちょうどいい</span></label>
                            <label class="w-full text-center cursor-pointer"><input type="radio" name="fit-preference" value="large" class="sr-only peer"><span class="block py-2 px-3 rounded-md peer-checked:bg-blue-500 peer-checked:text-white">大きい</span></label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. 購入したい服 -->
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                <h2 class="text-2xl font-bold mb-4 text-center text-red-600">2. 購入したい服</h2>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">サイトのサイズ表記は？</label>
                    <div class="flex justify-around bg-gray-100 p-1 rounded-lg">
                        <label class="w-full text-center cursor-pointer"><input type="radio" name="size-type" value="overseas" class="sr-only peer" checked><span class="block py-2 px-3 rounded-md peer-checked:bg-red-500 peer-checked:text-white">海外表記</span></label>
                        <label class="w-full text-center cursor-pointer"><input type="radio" name="size-type" value="japan" class="sr-only peer"><span class="block py-2 px-3 rounded-md peer-checked:bg-red-500 peer-checked:text-white">日本表記</span></label>
                    </div>
                </div>
                <div class="space-y-4">
                    <div>
                        <label for="buy-kitake" class="block text-sm font-medium text-gray-700">着丈</label>
                        <div class="relative mt-1">
                            <input type="number" id="buy-kitake" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-red-50 focus:ring-red-500 focus:border-red-500" value="72">
                            <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="buy-kitake" data-step="1">▲</button>
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="buy-kitake" data-step="-1">▼</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="buy-katahaba" class="block text-sm font-medium text-gray-700">肩幅</label>
                        <div class="relative mt-1">
                            <input type="number" id="buy-katahaba" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-red-50 focus:ring-red-500 focus:border-red-500" value="46">
                            <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="buy-katahaba" data-step="1">▲</button>
                                <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="buy-katahaba" data-step="-1">▼</button>
                            </div>
                        </div>
                    </div>
                    <!-- 海外表記用フィールド -->
                    <div id="overseas-fields" class="space-y-4">
                        <div>
                            <label for="buy-sodetake" class="block text-sm font-medium text-gray-700">袖丈 (Sleeve)</label>
                            <div class="relative mt-1">
                                <input type="number" id="buy-sodetake" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-red-50 focus:ring-red-500 focus:border-red-500" value="61">
                                <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                    <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="buy-sodetake" data-step="1">▲</button>
                                    <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="buy-sodetake" data-step="-1">▼</button>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="buy-kyoui" class="block text-sm font-medium text-gray-700">胸囲 (Chest)</label>
                            <div class="relative mt-1">
                                <input type="number" id="buy-kyoui" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-red-50 focus:ring-red-500 focus:border-red-500" value="110">
                                <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                    <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="buy-kyoui" data-step="1">▲</button>
                                    <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="buy-kyoui" data-step="-1">▼</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 日本表記用フィールド -->
                    <div id="japan-fields" class="hidden space-y-4">
                        <div>
                            <label for="buy-jp-yukitake" class="block text-sm font-medium text-gray-700">裄丈</label>
                            <div class="relative mt-1">
                                <input type="number" id="buy-jp-yukitake" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-red-50 focus:ring-red-500 focus:border-red-500" value="84">
                                <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                    <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="buy-jp-yukitake" data-step="1">▲</button>
                                    <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="buy-jp-yukitake" data-step="-1">▼</button>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="buy-jp-mihaba" class="block text-sm font-medium text-gray-700">身幅</label>
                            <div class="relative mt-1">
                                <input type="number" id="buy-jp-mihaba" class="w-full p-3 pr-12 border-gray-300 rounded-md bg-red-50 focus:ring-red-500 focus:border-red-500" value="55">
                                <div class="absolute inset-y-0 right-0 flex flex-col items-stretch justify-center p-1.5 space-y-px">
                                    <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-t-md text-xs font-bold flex items-center justify-center" data-target="buy-jp-mihaba" data-step="1">▲</button>
                                    <button type="button" class="step-button flex-1 px-2 bg-gray-200 hover:bg-gray-300 rounded-b-md text-xs font-bold flex items-center justify-center" data-target="buy-jp-mihaba" data-step="-1">▼</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 3. 比較結果エリア -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 bg-white p-6 rounded-xl shadow-md border border-gray-200">
            <!-- ビジュアル比較 -->
            <div id="visualizer-container" class="w-full aspect-square relative flex items-center justify-center bg-gray-50 rounded-lg">
                 <svg id="visualizer" viewBox="0 0 300 300" class="w-full h-full">
                    <!-- 基準となる服 (お手持ちの服) -->
                    <g id="base-shirt" fill="#bae6fd" stroke="#0ea5e9" stroke-width="1">
                        <rect id="base-shirt-body" x="100" y="50" width="100" height="150" />
                        <path id="base-shirt-sleeve-left" d="M 100 50 L 50 70 L 50 110 L 100 90 Z" />
                        <path id="base-shirt-sleeve-right" d="M 200 50 L 250 70 L 250 110 L 200 90 Z" />
                        <circle cx="150" cy="50" r="20" fill="#f0f9ff"/>
                    </g>
                    <!-- 比較対象の服 (購入したい服) -->
                    <g id="comparison-shirt" fill="#fda4af" stroke="#f43f5e" stroke-width="1">
                        <rect id="comparison-shirt-body" x="100" y="50" width="100" height="150" />
                        <path id="comparison-shirt-sleeve-left" d="M 100 50 L 50 70 L 50 110 L 100 90 Z" />
                        <path id="comparison-shirt-sleeve-right"d="M 200 50 L 250 70 L 250 110 L 200 90 Z" />
                        <circle cx="150" cy="50" r="20" fill="#fef2f2"/>
                    </g>
                    <text id="visualizer-placeholder" x="150" y="150" text-anchor="middle" font-size="12" fill="#9ca3af">サイズを入力して比較を開始</text>
                 </svg>
            </div>
            <!-- テキスト結果 -->
            <div id="result-card" class="bg-gray-800 text-white p-6 rounded-xl shadow-lg border border-gray-700 result-card flex flex-col justify-center">
                <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">比較結果</h2>
                <div id="result-content" class="space-y-3 text-lg">
                    <p class="text-center text-gray-400 py-8">両方のサイズを入力してください</p>
                </div>
                <div id="overall-result-container" class="mt-6 text-center hidden">
                    <h3 class="font-bold text-xl mb-2 text-yellow-400">総合評価</h3>
                    <div id="overall-result" class="p-4 rounded-lg text-2xl font-bold"></div>
                </div>
                 <div class="mt-8 text-center">
                    <button id="reset-button" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg transition-colors">リセット</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // DOM要素の取得
        const myInputs = {
            kitake: document.getElementById('my-kitake'),
            yukitake: document.getElementById('my-yukitake'),
            katahaba: document.getElementById('my-katahaba'),
            mihaba: document.getElementById('my-mihaba'),
        };
        const buyInputs = {
            kitake: document.getElementById('buy-kitake'),
            katahaba: document.getElementById('buy-katahaba'),
            sodetake: document.getElementById('buy-sodetake'),
            kyoui: document.getElementById('buy-kyoui'),
            jp_yukitake: document.getElementById('buy-jp-yukitake'),
            jp_mihaba: document.getElementById('buy-jp-mihaba'),
        };
        const fitPreferenceRadios = document.querySelectorAll('input[name="fit-preference"]');
        const sizeTypeRadios = document.querySelectorAll('input[name="size-type"]');
        
        const overseasFields = document.getElementById('overseas-fields');
        const japanFields = document.getElementById('japan-fields');

        const resultContent = document.getElementById('result-content');
        const overallResultContainer = document.getElementById('overall-result-container');
        const overallResult = document.getElementById('overall-result');
        const resetButton = document.getElementById('reset-button');
        
        // Visualizer SVG elements
        const visualizer = {
            placeholder: document.getElementById('visualizer-placeholder'),
            base: {
                group: document.getElementById('base-shirt'),
                body: document.getElementById('base-shirt-body'),
                sleeveL: document.getElementById('base-shirt-sleeve-left'),
                sleeveR: document.getElementById('base-shirt-sleeve-right'),
            },
            comp: {
                group: document.getElementById('comparison-shirt'),
                body: document.getElementById('comparison-shirt-body'),
                sleeveL: document.getElementById('comparison-shirt-sleeve-left'),
                sleeveR: document.getElementById('comparison-shirt-sleeve-right'),
            }
        };


        // サイズ表記タイプの切り替え
        sizeTypeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === 'overseas') {
                    overseasFields.classList.remove('hidden');
                    japanFields.classList.add('hidden');
                } else {
                    overseasFields.classList.add('hidden');
                    japanFields.classList.remove('hidden');
                }
                updateComparison();
            });
        });

        // SVGを更新する関数
        function updateVisualizer(my, buy) {
            const hasMyData = my.kitake > 0 && my.yukitake > 0 && my.katahaba > 0 && my.mihaba > 0;
            const hasBuyData = buy.kitake > 0 && buy.yukitake > 0 && buy.katahaba > 0 && buy.mihaba > 0;

            visualizer.placeholder.style.display = (hasMyData || hasBuyData) ? 'none' : 'block';
            visualizer.base.group.style.display = hasMyData ? 'block' : 'none';
            visualizer.comp.group.style.display = hasBuyData ? 'block' : 'none';
            
            if (!hasMyData && !hasBuyData) return;

            const scale = 2.5; // cm to px scale factor
            const centerX = 150;
            const topY = 30;
            const neckRadius = 20;

            // 基準の服を描画
            if (hasMyData) {
                const mySodetake = my.yukitake - (my.katahaba / 2);
                const bodyWidth = my.mihaba * scale;
                const bodyHeight = my.kitake * scale;
                const shoulderWidth = my.katahaba * scale;
                const sleeveLength = mySodetake * scale;

                visualizer.base.body.setAttribute('x', centerX - bodyWidth / 2);
                visualizer.base.body.setAttribute('y', topY);
                visualizer.base.body.setAttribute('width', bodyWidth);
                visualizer.base.body.setAttribute('height', bodyHeight);

                const shoulderY = topY;
                const shoulderLX = centerX - shoulderWidth / 2;
                const shoulderRX = centerX + shoulderWidth / 2;
                
                // 左袖
                const sleeveLPath = `M ${shoulderLX} ${shoulderY} L ${shoulderLX - sleeveLength} ${shoulderY + 20} L ${shoulderLX - sleeveLength} ${shoulderY + 60} L ${shoulderLX} ${shoulderY + 40} Z`;
                visualizer.base.sleeveL.setAttribute('d', sleeveLPath);
                // 右袖
                const sleeveRPath = `M ${shoulderRX} ${shoulderY} L ${shoulderRX + sleeveLength} ${shoulderY + 20} L ${shoulderRX + sleeveLength} ${shoulderY + 60} L ${shoulderRX} ${shoulderY + 40} Z`;
                visualizer.base.sleeveR.setAttribute('d', sleeveRPath);
            }

            // 比較の服を描画
            if (hasBuyData) {
                const buySodetake = buy.yukitake - (buy.katahaba / 2);
                const bodyWidth = buy.mihaba * scale;
                const bodyHeight = buy.kitake * scale;
                const shoulderWidth = buy.katahaba * scale;
                const sleeveLength = buySodetake * scale;

                visualizer.comp.body.setAttribute('x', centerX - bodyWidth / 2);
                visualizer.comp.body.setAttribute('y', topY);
                visualizer.comp.body.setAttribute('width', bodyWidth);
                visualizer.comp.body.setAttribute('height', bodyHeight);

                const shoulderY = topY;
                const shoulderLX = centerX - shoulderWidth / 2;
                const shoulderRX = centerX + shoulderWidth / 2;
                
                // 左袖
                const sleeveLPath = `M ${shoulderLX} ${shoulderY} L ${shoulderLX - sleeveLength} ${shoulderY + 20} L ${shoulderLX - sleeveLength} ${shoulderY + 60} L ${shoulderLX} ${shoulderY + 40} Z`;
                visualizer.comp.sleeveL.setAttribute('d', sleeveLPath);
                // 右袖
                const sleeveRPath = `M ${shoulderRX} ${shoulderY} L ${shoulderRX + sleeveLength} ${shoulderY + 20} L ${shoulderRX + sleeveLength} ${shoulderY + 60} L ${shoulderRX} ${shoulderY + 40} Z`;
                visualizer.comp.sleeveR.setAttribute('d', sleeveRPath);
            }
        }


        // メインの比較・更新関数
        function updateComparison() {
            const myValues = {
                kitake: parseFloat(myInputs.kitake.value) || 0,
                yukitake: parseFloat(myInputs.yukitake.value) || 0,
                katahaba: parseFloat(myInputs.katahaba.value) || 0,
                mihaba: parseFloat(myInputs.mihaba.value) || 0,
            };
            
            const fitPreference = document.querySelector('input[name="fit-preference"]:checked').value;
            const sizeType = document.querySelector('input[name="size-type"]:checked').value;

            const buyConvertedValues = {
                kitake: parseFloat(buyInputs.kitake.value) || 0,
                katahaba: parseFloat(buyInputs.katahaba.value) || 0,
                yukitake: 0,
                mihaba: 0
            };

            if (sizeType === 'overseas') {
                const sodetake = parseFloat(buyInputs.sodetake.value) || 0;
                const kyoui = parseFloat(buyInputs.kyoui.value) || 0;
                buyConvertedValues.yukitake = (buyConvertedValues.katahaba > 0 && sodetake > 0) ? (buyConvertedValues.katahaba / 2) + sodetake : 0;
                buyConvertedValues.mihaba = kyoui > 0 ? kyoui / 2 : 0;
            } else {
                buyConvertedValues.yukitake = parseFloat(buyInputs.jp_yukitake.value) || 0;
                buyConvertedValues.mihaba = parseFloat(buyInputs.jp_mihaba.value) || 0;
            }

            // ビジュアライザーを更新
            updateVisualizer(myValues, buyConvertedValues);

            const comparisons = {};
            let score = 0;
            const tolerance = 1.5;

            const fieldsToCompare = ['kitake', 'yukitake', 'katahaba', 'mihaba'];
            let hasInput = false;

            fieldsToCompare.forEach(field => {
                if (myValues[field] > 0 && buyConvertedValues[field] > 0) {
                    hasInput = true;
                    const diff = buyConvertedValues[field] - myValues[field];
                    let status = 'same';
                    if (diff > tolerance) { status = 'larger'; score++; } 
                    else if (diff < -tolerance) { status = 'smaller'; score--; }
                    comparisons[field] = { diff: diff, status: status };
                }
            });

            if (!hasInput) {
                resultContent.innerHTML = '<p class="text-center text-gray-400 py-8">両方のサイズを入力してください</p>';
                overallResultContainer.classList.add('hidden');
                return;
            }

            resultContent.innerHTML = '';
            const labels = { kitake: '着丈', yukitake: '裄丈', katahaba: '肩幅', mihaba: '身幅' };

            fieldsToCompare.forEach(field => {
                if (comparisons[field]) {
                    const comp = comparisons[field];
                    const diffText = comp.diff > 0 ? `+${comp.diff.toFixed(1)}` : comp.diff.toFixed(1);
                    let statusText = '';
                    let colorClass = 'text-gray-300';
                    if (comp.status === 'larger') { statusText = '大きめ'; colorClass = 'text-green-400'; } 
                    else if (comp.status === 'smaller') { statusText = '小さめ'; colorClass = 'text-red-400'; } 
                    else { statusText = 'ほぼ同じ'; colorClass = 'text-yellow-400'; }
                    
                    const p = document.createElement('p');
                    p.className = 'flex justify-between items-baseline';
                    p.innerHTML = `<span>${labels[field]}</span> <span class="font-mono text-right">${diffText}cm <span class="${colorClass} font-bold ml-2">(${statusText})</span></span>`;
                    resultContent.appendChild(p);
                }
            });
            
            let overallText = '';
            let overallColorClass = '';
            if (fitPreference === 'just') {
                if (score > 1) { overallText = '大きいかも'; overallColorClass = 'bg-yellow-500'; }
                else if (score < -1) { overallText = '小さいかも'; overallColorClass = 'bg-red-500'; }
                else { overallText = 'ちょうどよさそう'; overallColorClass = 'bg-green-500'; }
            } else if (fitPreference === 'small') {
                if (score > 0) { overallText = 'ちょうどよさそう'; overallColorClass = 'bg-green-500'; }
                else if (score === 0) { overallText = '小さいかも'; overallColorClass = 'bg-yellow-500'; }
                else { overallText = '小さい可能性大'; overallColorClass = 'bg-red-500'; }
            } else if (fitPreference === 'large') {
                if (score < 0) { overallText = 'ちょうどよさそう'; overallColorClass = 'bg-green-500'; }
                else if (score === 0) { overallText = '大きいかも'; overallColorClass = 'bg-yellow-500'; }
                else { overallText = '大きい可能性大'; overallColorClass = 'bg-red-500'; }
            }
            
            overallResult.textContent = overallText;
            overallResult.className = `p-4 rounded-lg text-2xl font-bold ${overallColorClass} text-white`;
            overallResultContainer.classList.remove('hidden');
        }

        function resetAll() {
            // デフォルト値に戻す
            myInputs.kitake.value = "70";
            myInputs.yukitake.value = "83";
            myInputs.katahaba.value = "44";
            myInputs.mihaba.value = "52";
            
            buyInputs.kitake.value = "72";
            buyInputs.katahaba.value = "46";
            buyInputs.sodetake.value = "61";
            buyInputs.kyoui.value = "110";
            buyInputs.jp_yukitake.value = "84";
            buyInputs.jp_mihaba.value = "55";

            document.querySelector('input[name="fit-preference"][value="just"]').checked = true;
            document.querySelector('input[name="size-type"][value="overseas"]').checked = true;
            overseasFields.classList.remove('hidden');
            japanFields.classList.add('hidden');
            updateComparison();
        }

        // 増減ボタンのロジック
        document.querySelectorAll('.step-button').forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.dataset.target;
                const step = parseFloat(button.dataset.step);
                const targetInput = document.getElementById(targetId);
                
                if (targetInput) {
                    let currentValue = parseFloat(targetInput.value) || 0;
                    let newValue = currentValue + step;
                    if (newValue < 0) {
                        newValue = 0; // マイナス値にはしない
                    }
                    targetInput.value = newValue;
                    
                    // 値の変更を即座に反映させる
                    updateComparison();
                }
            });
        });

        const allInputs = [...Object.values(myInputs), ...Object.values(buyInputs)];
        allInputs.forEach(input => input.addEventListener('input', updateComparison));
        fitPreferenceRadios.forEach(radio => radio.addEventListener('change', updateComparison));
        resetButton.addEventListener('click', resetAll);

        // 初期読み込み時にデフォルト値で比較を実行
        updateComparison();
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- Sidebar Logic ---
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarClose = document.getElementById('sidebar-close');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        
        function openSidebar() {
            if (!sidebar || !sidebarOverlay) return;
            sidebar.classList.remove('-translate-x-full');
            sidebarOverlay.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
        }
        
        function closeSidebar() {
            if (!sidebar || !sidebarOverlay) return;
            sidebar.classList.add('-translate-x-full');
            sidebarOverlay.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        }

        if (sidebarToggle) sidebarToggle.addEventListener('click', openSidebar);
        if (sidebarClose) sidebarClose.addEventListener('click', closeSidebar);
        if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeSidebar);
        
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeSidebar(); });

        // --- Active Page Highlight Logic ---
        try {
            const currentPath = window.location.pathname;
            document.querySelectorAll('#sidebar a').forEach(link => {
                const linkHref = link.getAttribute('href');
                // Create a full URL to resolve relative paths correctly
                const linkUrl = new URL(linkHref, window.location.href);
                if (linkUrl.pathname === currentPath) {
                    link.classList.add('bg-blue-600', 'text-white');
                    link.classList.remove('hover:bg-gray-700');
                }
            });
        } catch (e) {
            console.error("Error highlighting current page:", e);
        }
    });
    </script>
</body>
</html>

