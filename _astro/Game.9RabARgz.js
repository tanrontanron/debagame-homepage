import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.Cycvls3P.js";const d=[];for(let t=0;t<256;++t)d.push((t+256).toString(16).slice(1));function q(t,l=0){return(d[t[l+0]]+d[t[l+1]]+d[t[l+2]]+d[t[l+3]]+"-"+d[t[l+4]]+d[t[l+5]]+"-"+d[t[l+6]]+d[t[l+7]]+"-"+d[t[l+8]]+d[t[l+9]]+"-"+d[t[l+10]]+d[t[l+11]]+d[t[l+12]]+d[t[l+13]]+d[t[l+14]]+d[t[l+15]]).toLowerCase()}let C;const K=new Uint8Array(16);function Q(){if(!C){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");C=crypto.getRandomValues.bind(crypto)}return C(K)}const ee=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F={randomUUID:ee};function te(t,l,n){t=t||{};const o=t.random??t.rng?.()??Q();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,q(o)}function se(t,l,n){return F.randomUUID&&!t?F.randomUUID():te(t)}const g=({value:t,rolling:l})=>{const n={1:[e.jsx("div",{className:"dot dot-red dot-cc"},"cc")],2:[e.jsx("div",{className:"dot dot-tr"},"tr"),e.jsx("div",{className:"dot dot-bl"},"bl")],3:[e.jsx("div",{className:"dot dot-tr"},"tr"),e.jsx("div",{className:"dot dot-cc"},"cc"),e.jsx("div",{className:"dot dot-bl"},"bl")],4:[e.jsx("div",{className:"dot dot-tl"},"tl"),e.jsx("div",{className:"dot dot-tr"},"tr"),e.jsx("div",{className:"dot dot-bl"},"bl"),e.jsx("div",{className:"dot dot-br"},"br")],5:[e.jsx("div",{className:"dot dot-tl"},"tl"),e.jsx("div",{className:"dot dot-tr"},"tr"),e.jsx("div",{className:"dot dot-cc"},"cc"),e.jsx("div",{className:"dot dot-bl"},"bl"),e.jsx("div",{className:"dot dot-br"},"br")],6:[e.jsx("div",{className:"dot dot-tl"},"tl"),e.jsx("div",{className:"dot dot-ml"},"ml"),e.jsx("div",{className:"dot dot-bl"},"bl"),e.jsx("div",{className:"dot dot-tr"},"tr"),e.jsx("div",{className:"dot dot-mr"},"mr"),e.jsx("div",{className:"dot dot-br"},"br")]};return e.jsx("div",{className:`die-face ${l?"animate-shake":""}`,children:n[t]})},T=1e4,le=[100,500,1e3,5e3,1e4,5e4,1e5],I=()=>[Math.floor(Math.random()*6)+1,Math.floor(Math.random()*6)+1,Math.floor(Math.random()*6)+1],O=t=>{const l=[...t].sort((c,x)=>c-x),[n,o,s]=l;if(n===1&&o===1&&s===1)return{dice:t,type:"PINZORO",point:1,strength:5e3,multiplier:5,label:"ピンゾロ (5倍)"};if(n===o&&o===s)return{dice:t,type:"ARASHI",point:n,strength:3e3+n,multiplier:3,label:`アラシ ${n} (3倍)`};if(n===4&&o===5&&s===6)return{dice:t,type:"SHIGORO",point:0,strength:2e3,multiplier:2,label:"シゴロ (2倍)"};if(n===1&&o===2&&s===3)return{dice:t,type:"HIFUMI",point:0,strength:-2e3,multiplier:2,label:"ヒフミ (2倍払)"};let r=0;return n===o?r=s:o===s?r=n:n===s&&(r=o),r>0?{dice:t,type:"POINT",point:r,strength:1e3+r,multiplier:1,label:`出目 ${r}`}:{dice:t,type:"MENASHI",point:0,strength:0,multiplier:1,label:"目なし"}},ne=()=>{for(let t=1;t<=3;t++){const l=I(),n=O(l);if(n.type!=="MENASHI")return{hand:n,rollsCount:t};if(t===3)return{hand:n,rollsCount:3}}return{hand:O([1,2,3]),rollsCount:3}},ae=(t,l,n)=>{const o=t.hand.strength,s=l.hand.strength;let r=!1,c=!1,x=0,h="";return o>s?(r=!0,x=t.hand.multiplier,h=`${t.hand.label}で勝利！`):s>o?(r=!1,x=-l.hand.multiplier,h=`${l.hand.label}で敗北...`):(c=!0,x=0,h="引き分け (返金)"),r?l.hand.type==="HIFUMI"?(x=2,h="親がヒフミ！倍付け勝利！"):x=t.hand.multiplier:!r&&!c&&(t.hand.type==="HIFUMI"?(x=-2,h="ヒフミを出してしまった...倍付け支払い"):x=-l.hand.multiplier),{player:t,dealer:l,isPlayerWin:r,isDraw:c,finalMultiplier:x,payout:Math.floor(n*x),message:h}},w=t=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(t),V={totalGames:0,wins:0,losses:0,draws:0,maxBalance:T,minBalance:T,handCounts:{},totalWagered:0,totalPayout:0};function de(){const[t,l]=i.useState(T),[n,o]=i.useState(1e3),[s,r]=i.useState("IDLE"),[c,x]=i.useState(!1),[h,$]=i.useState([1,1,1]),[S,H]=i.useState([4,5,6]),[f,A]=i.useState(null),[M,U]=i.useState(null),[b,L]=i.useState(null),[j,P]=i.useState(0),[m,R]=i.useState(!1),[G,Y]=i.useState([]),[z,B]=i.useState(V),[D,W]=i.useState(!1);i.useRef(null);const y=i.useRef(null),Z=(a,p,E)=>{B(u=>{const N=a.player.hand.type,v={...u.handCounts,[N]:(u.handCounts[N]||0)+1};return{totalGames:u.totalGames+1,wins:u.wins+(a.isPlayerWin?1:0),losses:u.losses+(!a.isPlayerWin&&!a.isDraw?1:0),draws:u.draws+(a.isDraw?1:0),maxBalance:Math.max(u.maxBalance,p),minBalance:Math.min(u.minBalance,p),handCounts:v,totalWagered:u.totalWagered+E,totalPayout:u.totalPayout+a.payout}})},k=i.useCallback(()=>{if(s!=="IDLE")return;r("DEALER_TURN"),L(null),U(null),A(null),P(0),R(!0);const a=window.setInterval(()=>$(I()),50);setTimeout(()=>{clearInterval(a);const p=ne();$(p.hand.dice),A(p),R(!1),setTimeout(()=>{r("PLAYER_TURN"),P(3)},800)},1e3)},[s]),_=i.useCallback(()=>{if(s!=="PLAYER_TURN"||m)return;R(!0),P(p=>p-1);const a=window.setInterval(()=>H(I()),50);setTimeout(()=>{clearInterval(a);const p=I();H(p);const E=O(p);if(R(!1),E.type!=="MENASHI"||j<=1){const u={hand:E,rollsCount:4-j};if(U(u),r("RESULT"),f){const N=ae(u,f,n);L(N);const v=t+N.payout;l(v),Y(X=>[{id:se(),bet:n,result:N,balanceAfter:v,timestamp:Date.now()},...X].slice(0,50)),Z(N,v,n)}}},800)},[s,m,j,f,t,n]);i.useEffect(()=>{if(c)return s==="IDLE"?y.current=window.setTimeout(()=>k(),1e3):s==="PLAYER_TURN"&&!m?y.current=window.setTimeout(()=>_(),500):s==="RESULT"&&(y.current=window.setTimeout(()=>r("IDLE"),2e3)),()=>{y.current&&clearTimeout(y.current)}},[c,s,m,k,_]);const J=()=>{window.confirm("本当にリセットしますか？")&&(l(T),Y([]),B(V),r("IDLE"),L(null),A(null),U(null),x(!1))};return e.jsxs("div",{className:"min-h-screen bg-stone-950 flex flex-col items-center pb-12 font-sans text-stone-200",children:[e.jsxs("header",{className:"w-full max-w-md bg-stone-900 p-3 sticky top-0 z-20 border-b border-stone-800 flex justify-between items-center shadow-md rounded-b-xl",children:[e.jsx("h1",{className:"text-lg font-bold text-amber-500 tracking-wider",children:"無限チンチロ"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:`font-mono text-xl ${t<0?"text-red-500":"text-emerald-400"}`,children:w(t)}),e.jsx("button",{onClick:()=>W(!D),className:"text-xs bg-stone-800 px-2 py-1 rounded text-stone-400",children:D?"戻る":"成績"})]})]}),D?e.jsx(oe,{stats:z,onClose:()=>W(!1)}):e.jsxs("main",{className:"w-full max-w-md flex-1 flex flex-col p-3 space-y-4",children:[e.jsxs("div",{className:`relative rounded-2xl p-4 transition-all duration-300 flex flex-col items-center
                ${s==="DEALER_TURN"?"bg-red-950/40 ring-2 ring-red-500/50":"bg-stone-900/40"}`,children:[e.jsxs("div",{className:"text-xs text-red-400 font-bold uppercase tracking-widest mb-2",children:["親 (DEALER)",f&&e.jsxs("span",{className:"ml-2 text-stone-400",children:["(",f.rollsCount,"回で確定)"]})]}),e.jsxs("div",{className:`flex gap-3 scale-75 ${s==="DEALER_TURN"&&m?"animate-pulse blur-[1px]":""}`,children:[e.jsx(g,{value:h[0],rolling:s==="DEALER_TURN"&&m}),e.jsx(g,{value:h[1],rolling:s==="DEALER_TURN"&&m}),e.jsx(g,{value:h[2],rolling:s==="DEALER_TURN"&&m})]}),e.jsx("div",{className:"min-h-[2rem] mt-2",children:f?e.jsx("span",{className:"text-xl font-bold text-stone-200",children:f.hand.label}):s==="DEALER_TURN"?e.jsx("span",{className:"text-stone-500",children:"ロール中..."}):e.jsx("span",{className:"text-stone-700",children:"-"})})]}),e.jsx("div",{className:"text-center text-stone-600 font-black text-xl italic opacity-30 -my-2",children:"VS"}),e.jsxs("div",{className:`relative bg-green-900 rounded-3xl p-6 shadow-inner-xl border-4 border-stone-800 flex flex-col items-center justify-center min-h-[240px] overflow-hidden
                 ${s==="PLAYER_TURN"?"ring-4 ring-amber-400/50":""}`,children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_rgba(0,0,0,0)_20%,_rgba(0,0,0,0.4)_100%)] pointer-events-none"}),e.jsxs("div",{className:"absolute top-3 left-4 text-xs text-green-300/70 font-bold tracking-widest z-10",children:["子 (YOU) ",s==="PLAYER_TURN"&&`あと${j}回`]}),e.jsxs("div",{className:`flex gap-4 z-10 transition-all ${s==="PLAYER_TURN"&&m?"animate-shake blur-[1px]":""}`,children:[e.jsx(g,{value:S[0],rolling:s==="PLAYER_TURN"&&m}),e.jsx(g,{value:S[1],rolling:s==="PLAYER_TURN"&&m}),e.jsx(g,{value:S[2],rolling:s==="PLAYER_TURN"&&m})]}),e.jsx("div",{className:`z-10 mt-4 min-h-[2.5rem] flex flex-col items-center transition-transform ${s==="RESULT"?"-translate-y-4":""}`,children:M?e.jsx("span",{className:`text-2xl font-black ${b?.isPlayerWin?"text-amber-300":"text-stone-200"}`,children:M.hand.label}):s==="PLAYER_TURN"&&!m&&j<3?e.jsx("span",{className:"text-stone-400",children:"目なし (再ロール...)"}):null}),s==="RESULT"&&b&&e.jsxs("div",{className:"absolute inset-x-0 bottom-4 z-20 flex flex-col items-center justify-center animate-fadeIn",children:[e.jsx("div",{className:`text-5xl font-black mb-1 drop-shadow-2xl ${b.isPlayerWin?"text-yellow-400 drop-shadow-glow-gold":b.isDraw?"text-stone-300":"text-red-600 drop-shadow-glow-red"}`,children:b.isPlayerWin?"WIN!":b.isDraw?"DRAW":"LOSE"}),e.jsx("div",{className:"px-3 py-1 bg-black/40 rounded-full backdrop-blur-md text-stone-100 font-bold text-sm mb-1",children:b.message}),e.jsxs("div",{className:`text-2xl font-mono font-black ${b.payout>=0?"text-emerald-400":"text-red-500"}`,children:[b.payout>0?"+":"",w(b.payout)]})]})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx("div",{className:`grid grid-cols-4 sm:grid-cols-7 gap-1 ${s!=="IDLE"||c?"opacity-30 pointer-events-none":""}`,children:le.map(a=>e.jsx("button",{onClick:()=>o(a),className:`py-1 px-2 rounded text-xs font-mono font-bold ${n===a?"bg-amber-600 text-white":"bg-stone-800 text-stone-400"}`,children:a>=1e4?`${a/1e4}万`:a>=1e3?`${a/1e3}k`:a},a))}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:()=>x(!c),className:`col-span-1 py-3 rounded-xl font-bold text-xs flex flex-col items-center justify-center
                        ${c?"bg-indigo-600 text-white":"bg-stone-800 text-stone-400"}`,children:["AUTO ",c?"ON":"OFF"]}),s==="IDLE"?e.jsx("button",{onClick:k,disabled:c,className:"col-span-3 bg-amber-600 hover:bg-amber-500 disabled:opacity-50 text-white py-4 rounded-xl text-xl font-black tracking-widest shadow-lg shadow-amber-900/40",children:"勝負開始 (START)"}):s==="PLAYER_TURN"?e.jsx("button",{onClick:_,disabled:m||c,className:"col-span-3 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 text-white py-4 rounded-xl text-xl font-black tracking-widest shadow-lg shadow-blue-900/40",children:"振る (ROLL)"}):e.jsx("button",{onClick:()=>r("IDLE"),disabled:s!=="RESULT"||c,className:"col-span-3 bg-stone-700 text-stone-400 py-4 rounded-xl font-bold disabled:opacity-50",children:s==="RESULT"?"次へ (NEXT)":"..."})]})]}),G.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-stone-900/50 rounded-xl max-h-[120px] overflow-y-auto text-xs mask-gradient-bottom space-y-1",children:G.slice(0,10).map(a=>e.jsxs("div",{className:"flex justify-between text-stone-400",children:[e.jsxs("span",{children:["親:[",a.result.dealer.hand.dice.join(""),"] vs 子:[",a.result.player.hand.dice.join(""),"]"]}),e.jsxs("span",{className:a.result.payout>0?"text-emerald-400":a.result.payout<0?"text-red-400":"",children:[a.result.payout>0?"+":"",a.result.payout]})]},a.id))})]}),e.jsx("div",{className:"fixed bottom-2 right-2",children:e.jsx("button",{onClick:J,className:"text-xs bg-red-900/20 text-red-500/50 px-2 py-1 rounded hover:bg-red-900/50 hover:text-red-400 transition",children:"完全リセット"})})]})}const oe=({stats:t,onClose:l})=>{const n=t.totalGames>0?(t.wins/t.totalGames*100).toFixed(1):"0.0",o={PINZORO:"1-1-1 (最強, 5倍)",ARASHI:"同じ目x3 (2番目に強い, 3倍)",SHIGORO:"4-5-6 (即勝利, 2倍)",POINT:"同じ目x2 + 違う目 (通常役, 1倍)",MENASHI:"役なし (最弱)",HIFUMI:"1-2-3 (即負け, 2倍払)"};return e.jsxs("main",{className:"w-full max-w-md flex-1 p-4 overflow-y-auto space-y-6 bg-stone-900/90 text-stone-200",children:[e.jsx("h2",{className:"text-xl font-bold text-stone-200 mb-4",children:"戦績データ"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"bg-stone-800 p-3 rounded",children:["試行回数: ",e.jsx("span",{className:"float-right font-mono text-white",children:t.totalGames})]}),e.jsxs("div",{className:"bg-stone-800 p-3 rounded",children:["勝率: ",e.jsxs("span",{className:`float-right font-mono ${parseFloat(n)>50?"text-emerald-400":"text-white"}`,children:[n,"%"]})]}),e.jsxs("div",{className:"bg-stone-800 p-3 rounded",children:["最高所持金: ",e.jsx("div",{className:"font-mono text-amber-400 text-right",children:w(t.maxBalance)})]}),e.jsxs("div",{className:"bg-stone-800 p-3 rounded",children:["最低所持金: ",e.jsx("div",{className:"font-mono text-red-400 text-right",children:w(t.minBalance)})]}),e.jsxs("div",{className:"bg-stone-800 p-3 rounded col-span-2",children:["総配当収支: ",e.jsx("span",{className:`float-right font-mono ${t.totalPayout>=0?"text-emerald-400":"text-red-400"}`,children:w(t.totalPayout)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-stone-400 mb-2",children:"自分の役出現数"}),e.jsx("div",{className:"space-y-2 text-sm",children:["PINZORO","ARASHI","SHIGORO","POINT","MENASHI","HIFUMI"].map(s=>e.jsxs("div",{className:"flex flex-col bg-stone-800/50 rounded p-2",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"font-bold text-stone-200",children:s}),e.jsxs("span",{className:"font-mono text-white",children:[t.handCounts[s]||0,"回"]})]}),e.jsx("span",{className:"text-xs text-stone-500",children:o[s]})]},s))})]}),e.jsx("button",{onClick:l,className:"w-full py-3 bg-stone-700 text-stone-200 rounded-xl font-bold",children:"閉じる"})]})};export{de as default};
